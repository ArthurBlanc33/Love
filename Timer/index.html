<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Compteur de temps</title>
        <link rel="stylesheet" href="style.css" />
        <link rel="icon" type="image/png" href="hearthicone.png" />
        <link rel="manifest" href="manifest.json" />
    </head>
    <body>
    <div class="slider-container">
      <div class="slider-track" id="sliderTrack">
        <!-- Première diapositive -->
        <div class="container" id="mainCircle">
          <h1>On se revoit dans</h1>
          <div id="timer">0 jours</div>
          <div id="loveWord" class="red-text">ma chérie</div>
        </div>
        
        <!-- Deuxième diapositive (nouvelle structure) -->
        <div class="slide-item">
          <div class="container empty" id="emptyCircle">
            <img id="userImage" style="display:none; width:80%; height:80%; border-radius:50%; object-fit: cover;" />
          </div>
          <button id="addImageBtn">Ajouter une image</button>
        </div>

      </div>
    </div>

        <script>
    const loveWords = [
      "ma chérie", "ma princesse", "mon trésor", "mon cœur", "mon amour", "mon ange", "ma douce", "mon soleil", "ma belle", "ma perle"
    ];

    const targetDate = new Date(2025, 8, 12); // 12 septembre 2025
    const timerEl = document.getElementById("timer");
    let currentMode = "days";

    const chosenWord = loveWords[Math.floor(Math.random() * loveWords.length)];
    document.getElementById("loveWord").textContent = chosenWord;

    const container = document.getElementById('mainCircle');

    function updateTimer() {
      const now = new Date();
      const diffMs = targetDate - now;
      if (diffMs <= 0) {
        timerEl.textContent = "C'est aujourd'hui !";
        return;
      }
      const diffDays = Math.ceil(diffMs / (1000 * 60 * 60 * 24));
      const diffHours = Math.ceil(diffMs / (1000 * 60 * 60));
      const fullWeeks = Math.floor(diffDays / 7);
      const remainingDays = diffDays % 7;
      let text;
      switch (currentMode) {
        case "days":
          text = diffDays + " jours";
          break;
        case "hours":
          text = diffHours + " heures";
          break;
        case "weeks":
          if (remainingDays === 0) {
            text = `${fullWeeks} semaines`;
          } else {
            text = `${fullWeeks} semaines et ${remainingDays} jour${remainingDays > 1 ? "s" : ""}`;
          }
          break;
      }
      timerEl.textContent = text;
    }

    container.addEventListener("click", (e) => {
      e.preventDefault();
      if (currentMode === "days") currentMode = "hours";
      else if (currentMode === "hours") currentMode = "weeks";
      else currentMode = "days";
      updateTimer();
    });

    updateTimer();
    setInterval(updateTimer, 60000);

    // --- SLIDER LOGIC ---
    const sliderTrack = document.getElementById('sliderTrack');
    let startX = null;
    let currentTranslate = 0;
    let isDragging = false;
    
    function handleDragStart(clientX) {
        startX = clientX;
        isDragging = true;
        sliderTrack.style.transition = 'none'; // Pour un glissement fluide
    }

    function handleDragMove(clientX) {
        if (!isDragging || startX === null) return;
        const diff = clientX - startX;
        sliderTrack.style.transform = `translateX(${currentTranslate + diff}px)`;
    }

    function handleDragEnd(clientX) {
        if (!isDragging || startX === null) return;
        const diff = clientX - startX;
        sliderTrack.style.transition = 'transform 0.4s cubic-bezier(.4,2,.6,1)'; // Rétablir la transition
        if (diff < -80) { // Swipe vers la gauche
            currentTranslate = -350;
        } else if (diff > 80) { // Swipe vers la droite
            currentTranslate = 0;
        }
        sliderTrack.style.transform = `translateX(${currentTranslate}px)`;
        isDragging = false;
        startX = null;
    }

    // Touch events
    sliderTrack.addEventListener('touchstart', (e) => handleDragStart(e.touches[0].clientX));
    sliderTrack.addEventListener('touchmove', (e) => handleDragMove(e.touches[0].clientX));
    sliderTrack.addEventListener('touchend', (e) => handleDragEnd(e.changedTouches[0].clientX));

    // Mouse events
    sliderTrack.addEventListener('mousedown', (e) => handleDragStart(e.clientX));
    window.addEventListener('mousemove', (e) => handleDragMove(e.clientX));
    window.addEventListener('mouseup', (e) => handleDragEnd(e.clientX));


    // --- LOGIQUE D'AJOUT/SUPPRESSION D'IMAGE ---
    const addImageBtn = document.getElementById('addImageBtn');
    const userImage = document.getElementById('userImage');

    function updateImageUI() {
        if (userImage.src && userImage.style.display !== 'none') {
            addImageBtn.textContent = "Supprimer l'image";
        } else {
            userImage.style.display = 'none';
            userImage.src = '';
            addImageBtn.textContent = "Ajouter une image";
        }
    }

    addImageBtn.addEventListener('click', () => {
        // Si aucune image n'est affichée, on en ajoute une
        if (userImage.style.display === 'none') {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = e => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = function(evt) {
                    userImage.src = evt.target.result;
                    userImage.style.display = "block";
                    updateImageUI();
                };
                reader.readAsDataURL(file);
            };
            input.click();
        } else {
            // Sinon, on supprime l'image existante
            userImage.style.display = 'none';
            userImage.src = '';
            updateImageUI();
        }
    });

    // Initialiser l'UI au chargement
    updateImageUI();
  </script>
  <script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js");
  }
</script>
</body>
</html>